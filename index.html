
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
	<meta name="description" content="Code for Anchorage uses machine learning to find the optimal routes based on Randal Olson's code.">
	<meta name="author" content="Code for Anchorage based on Randal Olson's work">
	<title>An optimal biking tour of Anchorage Breweries</title>
	<style>
		html, body, #map-canvas {
			height: 100%;
			margin: 0px;
			padding: 0px
		}
		#panel {
			position: absolute;
			top: 5px;
			left: 50%;
			margin-left: -180px;
			z-index: 5;
			background-color: #fff;
			padding: 10px;
			border: 1px solid #999;
		}
		#menu{
			background-color:darkgray;
			position: absolute;
			padding: 10px;
			top: 100px;
			left: 5px;
			z-index: 6;
			/* DISABLING MENU BECAUSE CHOOSING A ROUTE MAKES LESS SENSE IF IT'S NOT A LOOP*/
			display: none
		}
		#menu h4{
			font-family:sans-serif;
			color:white;
		}
		#menu button{
			display: block;
			margin: 10px;
			width: 100px;

		}
	</style>
    <script src="MarkerCluster/markerclusterer.js"></script>
	<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&key=AIzaSyD4ZO5QaYEUf1BA1DkNhXUtBO-W3tqag2s"></script>
	<script>
		var map, bikeLayer;
		var directionsDisplayOptions = {
			preserveViewport: true,
			suppressMarkers: true,
			suppressBicyclingLayer: true //Otherwise layer disappears when route is changed
		};
		var directionsDisplay = new google.maps.DirectionsRenderer(directionsDisplayOptions);
		var infowindow = new google.maps.InfoWindow({
			size: new google.maps.Size(150,50)
		});

		var directionsService = new google.maps.DirectionsService();
		var start_finish = {};
		var waypoints = [];
		var markers = [];
        var markerCluster = null;

		const DEFAULT_WAYPOINTS = [
			{
				name: "Glacier Brewhouse",
				path: "North",
				address: "737 W 5th Ave Ste. 110, Anchorage, AK 99501",
				latlong: new google.maps.LatLng(61.21757050000001, -149.8964654)
			},
			{
				name: "49th State Brewing Co.",
				path: "North",
				address: "717 W 3rd Ave, Anchorage, AK 99501",
				latlong: new google.maps.LatLng(61.2195394, -149.8958217)
			},
			{
				name: "Resolution Brewing Company",
				path: "North",
				address: "3024 Mountain View Drive, Anchorage, AK 99501",
				latlong: new google.maps.LatLng(61.2199508, -149.823416)
			},
			{
				name: "Mooses Tooth Pub & Pizzeria",
				path: "South",
				address: "3300 Old Seward Hwy, Anchorage, AK",
				latlong: new google.maps.LatLng(61.19068459999999, -149.8682844)
			},
			{
				name: "Matanuska Brewing Company",
				path: "South",
				address: "2830 C Street, Anchorage, AK 99503",
				latlong: new google.maps.LatLng(61.1947333, -149.8884164)
			},
			{
				name: "Double Shovel Cider Company",
				path: "South",
				address: "502 W 58th Ave C, Anchorage, AK 99518",
				latlong: new google.maps.LatLng(61.168477, -149.8925806)
			},
			{
				name: "Cynosure Brewing",
				path: "South",
				address: "1363, 144 E Potter Dr unit e, Anchorage, AK 99518",
				latlong: new google.maps.LatLng(61.168569, -149.883072)
			},
			{
				name: "NOT A REAL PLACE TO GO",
				address: "323 E Dowling Rd, Anchorage, AK",
				path: "South",
				// latlong: new google.maps.LatLng(61.1663754, -149.8752732)
			},
			{
				name: "Turnagain Brewing",
				path: "South",
				address: "7920 & 7924 King Street, Anchorage, Alaska 99518",
				latlong: new google.maps.LatLng(61.14904, -149.878212)
			},
			{
				name: "Midnight Sun Brewing Co.",
				path: "South",
				address: "8111 Dimond Hook Dr, Anchorage, AK 99507",
				latlong: new google.maps.LatLng(61.1469204, -149.84449940000002)
			},
			{
				name: "Anchorage Brewing Company",
				path: "South",
				address: "148 West 91st Street, Anchorage, AK 99515",
				latlong: new google.maps.LatLng(61.1388234, -149.8815848)
			},
			{
				name: "King Street Brewing Company",
				path: "South",
				address: "9050 King St, Anchorage, AK 99515",
				latlong: new google.maps.LatLng(61.1389589, -149.8799729)
			},
		]


		function initialize() {
			var mapOptions = {
				zoom: 12,
				center: new google.maps.LatLng(61.180610, -149.868374)
			};
			map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
			//Add bike layer by default
			bikeLayer = new google.maps.BicyclingLayer();
			bikeLayer.setMap(map);
			//Load full path by default
			loadPath("Full");
		}

		function loadPath(pathName){
            clearRoute();
            markers = [];
            if(markerCluster){
                markerCluster.clearMarkers();
            }
            if(pathName == 'Full'){
				waypoints = DEFAULT_WAYPOINTS;
			}else{
				waypoints = DEFAULT_WAYPOINTS.filter(x => x.path == pathName);
			}
			start_finish = waypoints[0];

			directionsDisplay.setMap(map);

			// calcRoute(start_finish, start_finish, waypoints);
			calcRoute(start_finish, waypoints[waypoints.length - 1], waypoints);

			//add markers to route
			//createMarker(start_finish);
			waypoints.forEach(function(waypoint) {
				var marker = new google.maps.Marker({
					position: waypoint.latlong,
					map: map,
					icon: new google.maps.MarkerImage("http://brendanbabb.com/bike/beer.png"),
				});
				google.maps.event.addListener(marker, 'click', function() {
					infowindow.setContent('<b>'+waypoint.name+'</b><br>'+waypoint.address);
					infowindow.open(map, marker);
				});
				markers.push(marker);
			})

			// COMMENTING OUT BECAUSE IT'S NOT WORKING CONSISTENTLY
            // markerCluster = new MarkerClusterer(map, markers, {
            //     styles: [{
            //         url: 'img/m1.png',
            //         height: 53,
            //         width: 53,
            //         textColor: '#fff',
            //         textSize: 12
            //     }, {
            //         url: 'img/m2.png',
            //         height: 53,
            //         width: 53,
            //         textColor: '#fff',
            //         textSize: 12
            //     }, {
            //         url: 'img/m3.png',
            //         height: 53,
            //         width: 53,
            //         textColor: '#fff',
            //         textSize: 12
            //     }, {
            //         url: 'img/m4.png',
            //         height: 53,
            //         width: 53,
            //         textColor: '#fff',
            //         textSize: 12
            //     }, {
            //         url: 'img/m5.png',
            //         height: 53,
            //         width: 53,
            //         textColor: '#fff',
            //         textSize: 12
            //     }]
            // })
		}


		function calcRoute(start, end, routes) {
			var waypts = [];
			for (var i = 0; i < routes.length; i++) {
				waypts.push({
					location: routes[i].address,
					stopover: true
				});
			}
			var request = {
				origin: start.address,
				destination: end.address,
				waypoints: waypts,
				optimizeWaypoints: false,
				travelMode: google.maps.TravelMode.BICYCLING
			};
			directionsService.route(request, function(response, status) {
				if (status == google.maps.DirectionsStatus.OK) {
					directionsDisplay.setDirections(response);
				}
			});
		}


		function clearRoute(){
			waypoints = [];
			directionsDisplay.setMap(null);
        }


		google.maps.event.addDomListener(window, 'load', initialize);
	</script>
</head>
<body>
	<div id="map-canvas"></div>
	<div id="menu">
		<h4>Choose your Path!</h4>
		<button onclick='loadPath("Full")'>Full Path</button>
		<button onclick='loadPath("North")'>North Path</button>
		<button onclick='loadPath("South")'>South Path</button>
	</div>
</body>
